{% extends "base.html" %}
{% load static %}

{% block title %}HTML to PDF – VetriFiles{% endblock %}

{% block content %}
<div class="col-md-8 mx-auto">
    <h4 class="mb-3">HTML → PDF</h4>

    <form method="post" id="htmlForm">
        {% csrf_token %}

        <!-- Drag & Drop -->
        <div id="drop-area" class="border p-3 mb-3 rounded text-center" style="cursor:pointer;">
            Drag & drop HTML file here or click to select
            <input type="file" id="fileElem" accept=".html,.htm" hidden>
        </div>

        <!-- HTML Textarea -->
        <div class="mb-3">
            <textarea name="html"
                      id="htmlInput"
                      class="form-control"
                      rows="10"
                      placeholder="<h1>Hello VetriFiles</h1>"
                      required></textarea>
        </div>

        <!-- Output Filename -->
        <div class="mb-3">
            <input type="text" name="filename" id="filename" class="form-control" placeholder="document">
        </div>

        <button class="btn btn-success w-100" type="submit">Convert to PDF</button>
    </form>

    <h5 class="mt-4">Live Preview</h5>
    <div id="preview" class="border p-3" style="min-height:300px; background:#f8f9fa;">
        Preview will appear here...
    </div>

    <p class="text-muted mt-3">
        Supports basic HTML & inline CSS.
    </p>
</div>

<script>
const dropArea = document.getElementById("drop-area");
const fileElem = document.getElementById("fileElem");
const htmlInput = document.getElementById("htmlInput");
const preview = document.getElementById("preview");

// Drag & drop events
dropArea.onclick = () => fileElem.click();
dropArea.ondragover = e => { e.preventDefault(); dropArea.classList.add("bg-light"); };
dropArea.ondragleave = () => dropArea.classList.remove("bg-light");
dropArea.ondrop = e => {
    e.preventDefault();
    dropArea.classList.remove("bg-light");
    if(e.dataTransfer.files.length) loadFile(e.dataTransfer.files[0]);
};

// File select
fileElem.onchange = e => { if(e.target.files.length) loadFile(e.target.files[0]); };

// Load HTML file into textarea and preview
function loadFile(file){
    if(!file || !file.name.match(/\.html?$/i)) { alert("Please select an HTML file"); return; }

    const reader = new FileReader();
    reader.onload = e => {
        htmlInput.value = e.target.result;
        updatePreview();
    };
    reader.readAsText(file);
}

// Update live preview
function updatePreview(){
    preview.innerHTML = htmlInput.value || "Preview will appear here...";
}

// Listen to textarea changes
htmlInput.addEventListener("input", updatePreview);
</script>
{% endblock %}
